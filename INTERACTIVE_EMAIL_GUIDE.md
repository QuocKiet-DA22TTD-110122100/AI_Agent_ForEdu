# ğŸ“§ HÆ°á»›ng Dáº«n Gá»­i Email ThÃ´ng Minh Qua Chatbox

## ğŸ¯ TÃ­nh nÄƒng má»›i

Giá» Ä‘Ã¢y báº¡n cÃ³ thá»ƒ **gá»­i email trá»±c tiáº¿p tá»« chatbox** vá»›i sá»± há»— trá»£ cá»§a AI:

1. âœ… **Suggest contacts tá»± Ä‘á»™ng** tá»« Gmail cá»§a báº¡n
2. âœ… **AI táº¡o ná»™i dung email** dá»±a trÃªn chá»§ Ä‘á»
3. âœ… **Chá»‰nh sá»­a trÆ°á»›c khi gá»­i**
4. âœ… **Gá»­i ngay trong chatbox**

## ğŸš€ CÃ¡ch sá»­ dá»¥ng

### BÆ°á»›c 1: Káº¿t ná»‘i Gmail

TrÆ°á»›c tiÃªn, cáº§n káº¿t ná»‘i Google Account:

1. VÃ o **Settings** (trang cÃ i Ä‘áº·t)
2. TÃ¬m má»¥c **"Google Cloud Integration"**
3. Click nÃºt **"Connect Google"**
4. ÄÄƒng nháº­p vÃ  cáº¥p quyá»n

### BÆ°á»›c 2: Gá»­i email qua chatbox

#### **CÃ¡ch 1: AI suggest contacts (RECOMMENDED)**

Chá»‰ cáº§n nÃ³i chá»§ Ä‘á» email, AI sáº½ gá»£i Ã½ ngÆ°á»i nháº­n:

```
User: "gá»­i email xin nghá»‰ há»c Ä‘áº¿n tháº§y"
```

**AI sáº½:**
1. Láº¥y danh sÃ¡ch contacts tá»« Gmail cá»§a báº¡n
2. Hiá»ƒn thá»‹ top 10 ngÆ°á»i báº¡n thÆ°á»ng gá»­i email
3. Cho báº¡n chá»n báº±ng sá»‘

```
ğŸ“§ Gá»­i email: xin nghá»‰ há»c

ğŸ“‹ Chá»n ngÆ°á»i nháº­n:

1. Nguyá»…n VÄƒn A (teacher.a@tvu.edu.vn) _5 emails_
2. Tráº§n Thá»‹ B (teacher.b@tvu.edu.vn) _3 emails_
3. PhÃ²ng ÄÃ o Táº¡o (daotao@tvu.edu.vn) _10 emails_
...

ğŸ’¡ CÃ¡ch chá»n:
â€¢ Nháº¯n sá»‘: "1" hoáº·c "chá»n 1"
â€¢ Hoáº·c gÃµ email trá»±c tiáº¿p: "teacher@tvu.edu.vn"
```

#### **BÆ°á»›c 3: Chá»n ngÆ°á»i nháº­n**

```
User: "1"
hoáº·c
User: "chá»n 1"
```

**AI sáº½:**
1. Táº¡o draft email tá»± Ä‘á»™ng báº±ng AI (Groq/Gemini)
2. Hiá»ƒn thá»‹ preview Ä‘á»ƒ báº¡n xem trÆ°á»›c

```
ğŸ“ Draft Email Ä‘Ã£ táº¡o:

ğŸ“§ NgÆ°á»i nháº­n: Nguyá»…n VÄƒn A (teacher.a@tvu.edu.vn)
ğŸ“Œ Chá»§ Ä‘á»: Xin phÃ©p nghá»‰ há»c

ğŸ“„ Ná»™i dung:
---
KÃ­nh gá»­i tháº§y Nguyá»…n VÄƒn A,

Em lÃ  [TÃªn cá»§a báº¡n], sinh viÃªn lá»›p [Lá»›p]. 
Em xin phÃ©p Ä‘Æ°á»£c nghá»‰ há»c buá»•i há»c ngÃ y mai 
vÃ¬ lÃ½ do sá»©c khá»e.

Em xin cáº£m Æ¡n tháº§y!

TrÃ¢n trá»ng,
[TÃªn cá»§a báº¡n]
---

âœ… Náº¿u Ä‘á»“ng Ã½: nháº¯n "gá»­i" hoáº·c "ok"
âœï¸ Chá»‰nh sá»­a: nháº¯n "sá»­a [pháº§n cáº§n sá»­a]"
âŒ Há»§y: nháº¯n "há»§y"
```

#### **BÆ°á»›c 4: XÃ¡c nháº­n hoáº·c chá»‰nh sá»­a**

**Option A: Gá»­i luÃ´n**
```
User: "gá»­i"
hoáº·c
User: "ok"
```

**Option B: Chá»‰nh sá»­a**
```
User: "sá»­a ná»™i dung: Em xin nghá»‰ há»c vÃ¬ cÃ³ viá»‡c gia Ä‘Ã¬nh Ä‘á»™t xuáº¥t"
```

AI sáº½ cáº­p nháº­t draft vÃ  cho báº¡n xem láº¡i.

**Option C: Há»§y**
```
User: "há»§y"
```

#### **BÆ°á»›c 5: Email Ä‘Æ°á»£c gá»­i!**

```
âœ… Email Ä‘Ã£ gá»­i thÃ nh cÃ´ng!

ğŸ“§ NgÆ°á»i nháº­n: teacher.a@tvu.edu.vn
ğŸ“ Chá»§ Ä‘á»: Xin phÃ©p nghá»‰ há»c
ğŸ“… Thá»i gian: 14:30 23/12/2025
```

---

## ğŸ“ VÃ­ dá»¥ Use Cases

### Use Case 1: Xin nghá»‰ há»c

```
User: "gá»­i email xin nghá»‰ há»c Ä‘áº¿n tháº§y"
AI: [Hiá»ƒn thá»‹ list giÃ¡o viÃªn]
User: "1"
AI: [Táº¡o draft email xin nghá»‰]
User: "gá»­i"
AI: âœ… ÄÃ£ gá»­i!
```

### Use Case 2: Há»i bÃ i

```
User: "gá»­i mail há»i bÃ i táº­p vá» nhÃ "
AI: [Suggest contacts]
User: "chá»n 2"
AI: [Draft email há»i bÃ i]
User: "sá»­a: em muá»‘n há»i bÃ i táº­p chÆ°Æ¡ng 3"
AI: [Update draft]
User: "ok"
AI: âœ… Gá»­i thÃ nh cÃ´ng!
```

### Use Case 3: LiÃªn há»‡ phÃ²ng ban

```
User: "soáº¡n email há»i vá» thá»§ tá»¥c xin giáº¥y chá»©ng nháº­n"
AI: [Suggest: PhÃ²ng ÄÃ o Táº¡o, VP Khoa,...]
User: "3"
AI: [Draft chuyÃªn nghiá»‡p]
User: "gá»­i"
```

---

## ğŸ¨ CÃ¡ch 2: Gá»­i trá»±c tiáº¿p (KhÃ´ng cáº§n suggest)

Náº¿u báº¡n Ä‘Ã£ biáº¿t email ngÆ°á»i nháº­n:

```
User: "gá»­i email cho teacher@tvu.edu.vn chá»§ Ä‘á» Xin nghá»‰ há»c ná»™i dung Em xin phÃ©p nghá»‰ há»c ngÃ y mai vÃ¬ á»‘m"
```

AI sáº½ gá»­i ngay mÃ  khÃ´ng cáº§n qua bÆ°á»›c suggest.

---

## âš™ï¸ CÃ´ng nghá»‡ sá»­ dá»¥ng

### Backend
- **Gmail API (OAuth 2.0)**: Truy cáº­p Gmail an toÃ n
- **Groq AI / Gemini**: Generate ná»™i dung email thÃ´ng minh
- **Contact Analysis**: PhÃ¢n tÃ­ch sent emails Ä‘á»ƒ suggest

### Flow Architecture

```
User Message
    â†“
Detect Send Email Intent
    â†“
Has recipient email?
    â”œâ”€ YES â†’ Parse & Send directly
    â””â”€ NO â†’ Get contacts from Gmail
        â†“
    Display contacts list
        â†“
    Wait for user selection
        â†“
    AI generate draft email
        â†“
    Show preview
        â†“
    Wait for confirm/edit
        â†“
    Send email via Gmail API
```

---

## ğŸ”’ Báº£o máº­t & Quyá»n riÃªng tÆ°

### âœ… An toÃ n tuyá»‡t Ä‘á»‘i

1. **OAuth 2.0**: KhÃ´ng lÆ°u máº­t kháº©u Gmail
2. **Token encrypted**: Access tokens Ä‘Æ°á»£c mÃ£ hÃ³a trong database
3. **User control**: Báº¡n cÃ³ toÃ n quyá»n vá»›i emails cá»§a mÃ¬nh
4. **No storage**: KhÃ´ng lÆ°u ná»™i dung email cá»§a báº¡n

### Quyá»n truy cáº­p Gmail

Khi connect Google, app xin cÃ¡c quyá»n:

- âœ… **gmail.readonly**: Äá»c emails (Ä‘á»ƒ láº¥y contacts)
- âœ… **gmail.send**: Gá»­i email thay báº¡n
- âœ… **gmail.compose**: Táº¡o draft
- âœ… **gmail.modify**: ÄÃ¡nh dáº¥u Ä‘Ã£ Ä‘á»c/chÆ°a Ä‘á»c

ğŸ‘‰ **Báº¡n cÃ³ thá»ƒ thu há»“i quyá»n báº¥t cá»© lÃºc nÃ o** táº¡i: https://myaccount.google.com/permissions

---

## ğŸ› Troubleshooting

### Lá»—i: "ChÆ°a káº¿t ná»‘i Gmail"

**Giáº£i phÃ¡p:**
1. VÃ o Settings
2. Click "Connect Google"
3. ÄÄƒng nháº­p vÃ  cáº¥p quyá»n

### Lá»—i: "KhÃ´ng tÃ¬m tháº¥y contacts"

**NguyÃªn nhÃ¢n:** Báº¡n chÆ°a tá»«ng gá»­i email nÃ o qua Gmail

**Giáº£i phÃ¡p:**
- Sá»­ dá»¥ng cÃ¡ch 2: Gá»­i trá»±c tiáº¿p vá»›i email address
- Hoáº·c gá»­i vÃ i email thá»§ cÃ´ng trÆ°á»›c Ä‘á»ƒ táº¡o contact list

### Lá»—i: Token expired

**Giáº£i phÃ¡p:**
1. Disconnect Google trong Settings
2. Connect láº¡i
3. Token sáº½ tá»± Ä‘á»™ng refresh

---

## ğŸ¯ Roadmap (Coming Soon)

- [ ] **Attach files**: ÄÃ­nh kÃ¨m tÃ i liá»‡u tá»« Google Drive
- [ ] **Templates**: LÆ°u máº«u email thÆ°á»ng dÃ¹ng
- [ ] **Scheduled send**: Háº¹n giá» gá»­i email
- [ ] **CC/BCC support**: Gá»­i CC cho nhiá»u ngÆ°á»i
- [ ] **Email signatures**: Tá»± Ä‘á»™ng thÃªm chá»¯ kÃ½
- [ ] **Smart reply**: AI suggest cÃ¢u tráº£ lá»i nhanh

---

## ğŸ’¡ Tips & Tricks

### 1. Context-aware AI

AI sáº½ Ä‘iá»u chá»‰nh tone dá»±a trÃªn ngÆ°á»i nháº­n:
- GiÃ¡o viÃªn â†’ **Trang trá»ng, lá»‹ch sá»±**
- Báº¡n bÃ¨ â†’ **ThÃ¢n thiá»‡n, casual**
- PhÃ²ng ban â†’ **ChuyÃªn nghiá»‡p, sÃºc tÃ­ch**

### 2. Smart keywords

Báº¡n cÃ³ thá»ƒ dÃ¹ng nhiá»u tá»« khÃ³a:
- "gá»­i email xin nghá»‰" âœ…
- "soáº¡n mail há»i bÃ i" âœ…
- "viáº¿t email cáº£m Æ¡n" âœ…
- "draft email report" âœ…

### 3. Multi-language

AI hiá»ƒu cáº£ tiáº¿ng Viá»‡t vÃ  tiáº¿ng Anh:
- "send email to teacher about homework"
- "gá»­i mail cho tháº§y vá» bÃ i táº­p"

---

## ğŸ“š API Documentation

### Endpoints má»›i

#### `GET /api/gmail/contacts/{user_id}`
Láº¥y danh sÃ¡ch contacts tá»« sent emails

#### `POST /api/gmail/draft`
Táº¡o draft email báº±ng AI

```json
{
  "subject_keyword": "xin nghá»‰ há»c",
  "recipient_name": "tháº§y Nguyá»…n VÄƒn A"
}
```

#### `POST /api/gmail/send`
Gá»­i email

```json
{
  "user_id": 1,
  "to": "teacher@tvu.edu.vn",
  "subject": "Xin nghá»‰ há»c",
  "body": "..."
}
```

---

## ğŸ†˜ Support

Náº¿u gáº·p váº¥n Ä‘á»:

1. **Check logs**: Backend terminal sáº½ hiá»ƒn thá»‹ errors
2. **Re-connect**: Thá»­ disconnect vÃ  connect láº¡i Google
3. **Check permissions**: Xem quyá»n táº¡i Google Account settings

---

**Happy emailing! ğŸ“§âœ¨**
